<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>jongle.main &#8212; documentation IREM-Jongle 1.1</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="top" title="documentation IREM-Jongle 1.1" href="../../index.html" />
    <link rel="up" title="Code du module" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentation IREM-Jongle 1.1</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Code du module</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Code source de jongle.main</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">pydoc</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">cv2</span><span class="o">,</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtSvg</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">QTranslator</span><span class="p">,</span> <span class="n">QLocale</span><span class="p">,</span> <span class="n">QLibraryInfo</span><span class="p">,</span> <span class="n">QSize</span>
<span class="kn">from</span> <span class="nn">xml.dom</span> <span class="k">import</span> <span class="n">minidom</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">xml.dom.minidom</span> <span class="k">import</span> <span class="n">parseString</span>

<span class="kn">from</span> <span class="nn">.Ui_main</span> <span class="k">import</span> <span class="n">Ui_MainWindow</span>
<span class="kn">from</span> <span class="nn">.objetphysique</span> <span class="k">import</span> <span class="n">ObjetPhysique</span>
<span class="kn">from</span> <span class="nn">.matrix</span> <span class="k">import</span> <span class="n">matrix</span>
<span class="kn">from</span> <span class="nn">.pythonSyntax</span> <span class="k">import</span> <span class="n">PythonHighlighter</span>


<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">):</span>
<div class="viewcode-block" id="MainWindow.__init__"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">svg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">delta_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">ech</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">videofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">progfile</span><span class="o">=</span><span class="s2">&quot;jongle/fonction_base.py&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        le constructeur</span>

<span class="sd">        :param parent: un parent</span>
<span class="sd">        :type parent: QWidget</span>
<span class="sd">        :param svg: un nom de fichier au format SVG</span>
<span class="sd">        :type svg: str</span>
<span class="sd">        :param delta_t: l&#39;intervalle de temps entre deux images; la fonction</span>
<span class="sd">          de rappel self.runhooks est appelée entre deux images</span>
<span class="sd">        :type delta_t: float</span>
<span class="sd">        :param ech: l&#39;échelle à appliquer à l&#39;image</span>
<span class="sd">        :type ech: float</span>
<span class="sd">        :param videofile: un fichier video, à 25 images par secondes</span>
<span class="sd">        :type videofile: str</span>
<span class="sd">        :param progfile: un fichier Python qui contient des fonctions agissant sur un ObjetPhysique</span>
<span class="sd">        :type progfile: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">=</span><span class="n">Ui_MainWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectUi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="n">PythonHighlighter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progEdit</span><span class="o">.</span><span class="n">document</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_t</span><span class="o">=</span><span class="n">delta_t</span> <span class="k">if</span> <span class="n">delta_t</span> <span class="k">else</span> <span class="mf">40e-3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ech</span><span class="o">=</span><span class="n">ech</span> <span class="k">if</span> <span class="n">ech</span> <span class="k">else</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="o">=</span><span class="kc">None</span>
        <span class="c1"># trouve les objets physiques et ajoute des widgets pour y accéder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objetsPhysiques</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trouveObjetsPhysiques</span><span class="p">(</span><span class="n">minidom</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">svg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">afficheListeObjets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sceneTab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stillFrame</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># pointeur vers l&#39;image gelée</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progEdit</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">progfile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># liste de fonctions pour la simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectoires</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># liste d&#39;ensembles d&#39;objets se déplaçant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="o">=</span><span class="n">videoToRgbFrameList</span><span class="p">(</span><span class="n">videofile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videoHeight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">videoWidth</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SVGObjets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">svgWidget</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objIdents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1"># identifiants des objets sélectionnés</span>
        <span class="c1"># la boucle pour afficher les images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeHook</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_t</span><span class="p">)</span>
        <span class="c1"># compile et enregistre les fonctions de l&#39;onglet d&#39;édition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enregistreFonctions</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.connectUi"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.connectUi">[docs]</a>    <span class="k">def</span> <span class="nf">connectUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        connecte les évènements de l&#39;interface utilisateur avec</span>
<span class="sd">        les fonctions de rappel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">playButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">backButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">back</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">simulButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enregistreFonctions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minusButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oneBack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plusButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oneForward</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">saveAsButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveAs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">compileButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tryCompile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave_standalone</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpen</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCheck_Synta_x</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tryCompile</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.saveAs"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.saveAs">[docs]</a>    <span class="k">def</span> <span class="nf">saveAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="c1"># remise à zéro</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">:</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">,</span> <span class="n">ok</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;File to save the programs&quot;</span><span class="p">),</span> <span class="n">defaultDir</span><span class="p">,</span> <span class="s2">&quot;*.py&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="o">+=</span><span class="s2">&quot;.py&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nameTabProg</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MainWindow.nameTabProg"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.nameTabProg">[docs]</a>    <span class="k">def</span> <span class="nf">nameTabProg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Met à jour le nom de l&#39;onglet des programmes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progTab</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Programs (</span><span class="si">{p}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span>
            <span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.save"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="c1"># remise à zéro</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveAs</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progEdit</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">())</span>
        <span class="k">return</span></div>
        
<div class="viewcode-block" id="MainWindow.openFile"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.openFile">[docs]</a>    <span class="k">def</span> <span class="nf">openFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="c1"># remise à zéro</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">:</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">,</span> <span class="n">ok</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Open a file&quot;</span><span class="p">),</span> <span class="n">defaultDir</span><span class="p">,</span> <span class="s2">&quot;*.py&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progEdit</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progFileName</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nameTabProg</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.SVGObjets"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.SVGObjets">[docs]</a>    <span class="k">def</span> <span class="nf">SVGObjets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objDict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crée un document SVG à la taille du svgWidget, qui contient les objets</span>
<span class="sd">        de la liste à afficher</span>

<span class="sd">        :param objDict: dictionnaire d&#39;objets SVG ; s&#39;il est None, on prendra self.objetsPhysiques</span>
<span class="sd">        :type objDict: {nom: &lt;instance de ObjetPhysique&gt;, ...}</span>
<span class="sd">        :param w: largeur du document SVG</span>
<span class="sd">        :return: un document SVG</span>
<span class="sd">        :rtype: xml.dom.Document</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">objDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">objDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objetsPhysiques</span>
        <span class="n">svgCode</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;svg width=&quot;</span><span class="si">{w}</span><span class="s2">&quot; height=&quot;</span><span class="si">{h}</span><span class="s2">&quot; viewBox=&quot;0 0 </span><span class="si">{w}</span><span class="s2"> </span><span class="si">{h}</span><span class="s2">&quot;&gt;&lt;/svg&gt;&quot;&quot;&quot;</span>
        <span class="n">doc</span><span class="o">=</span><span class="n">parseString</span><span class="p">(</span><span class="n">svgCode</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">videoWidth</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">videoHeight</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ident</span> <span class="ow">in</span> <span class="n">objDict</span><span class="p">:</span>
            <span class="n">o</span><span class="o">=</span><span class="n">objDict</span><span class="p">[</span><span class="n">ident</span><span class="p">]</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">documentElement</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">doc</span></div>

<div class="viewcode-block" id="MainWindow.refresh"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rafraichit le svgWidget avec la position i</span>

<span class="sd">        :param i: index de l&#39;image en cours</span>
<span class="sd">        :type  i: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SVGObjets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectoires</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">svgWidget</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animProgress</span><span class="p">()</span>
        <span class="k">return</span></div>
        
<div class="viewcode-block" id="MainWindow.oneBack"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.oneBack">[docs]</a>    <span class="k">def</span> <span class="nf">oneBack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fonction de rappel pour revenir en arrière d&#39;une image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">-=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.oneForward"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.oneForward">[docs]</a>    <span class="k">def</span> <span class="nf">oneForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fonction de rappel pour avancer d&#39;une image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">+=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">)</span>
        <span class="k">return</span></div>

        
<div class="viewcode-block" id="MainWindow.mouseMoveEvent"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        traite le mouvement de la souris quand un bouton est pressé.</span>
<span class="sd">        Les objets qui ont été cochés dans le cadre du bas se déplacent</span>
<span class="sd">        en même temps qu&#39;on bouge la souris.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
            <span class="c1"># pas d&#39;animation en cours, on peut bouger les objets</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span><span class="p">:</span> <span class="k">return</span> <span class="c1"># cette ligne est redondante</span>
            <span class="n">mv</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prevPos</span>
            <span class="n">objetsPhysiques</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectoires</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stillFrame</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="n">objetsPhysiques</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
               <span class="n">o</span><span class="o">.</span><span class="n">moveInSVG</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ech</span><span class="p">)</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">setCbText</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stillFrame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prevPos</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.setCbText"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.setCbText">[docs]</a>    <span class="k">def</span> <span class="nf">setCbText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ajuste le texte d&#39;une case à cocher</span>
<span class="sd">        </span>
<span class="sd">        :param op: un objet physique</span>
<span class="sd">        :type  op: ObjetPhysique</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%6.2f</span><span class="s2">, </span><span class="si">%6.2f</span><span class="s2">)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.mousePressEvent"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite l&#39;évènement de bouton de souris pressé. Débute le « tirer »</span>
<span class="sd">        en enregistrant la position courante</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prevPos</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.mouseReleaseEvent"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.mouseReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite l&#39;évènement de bouton de souris relâché. Fin du « tirer ».</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.timeHook"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.timeHook">[docs]</a>    <span class="k">def</span> <span class="nf">timeHook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fonction de rappel (25 fois par seconde). Selon fait le choix entre</span>
<span class="sd">        faire avancer les calculs de simulation, et monter l&#39;animation </span>
<span class="sd">        (quand la simulation est terminée, on dispose de toutes les images</span>
<span class="sd">        de l&#39;animation, prêtes à servir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simule</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulProgress</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animProgress</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># self.currentFrame == self.count</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="o">=</span><span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="o">=</span><span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;The simulation is finished&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">()</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="MainWindow.trouveObjetsPhysiques"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.trouveObjetsPhysiques">[docs]</a>    <span class="k">def</span> <span class="nf">trouveObjetsPhysiques</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        met à jour la liste self.objetsPhysiques avec tous les</span>
<span class="sd">        elements &lt;g&gt; du DOM, qui ont un attribut</span>
<span class="sd">        transform=&quot;matrix(a,b,c,d,e,f)&quot;, puis crée des cases à cocher</span>
<span class="sd">        pour sélectionner les objets physiques.</span>

<span class="sd">        :param doc: un document SVG</span>
<span class="sd">        :type  doc: xml.dom</span>
<span class="sd">        :return: un dictionnaire ordonné identifiant =&gt; ObjetPhysique</span>
<span class="sd">        :rtype: OrderedDict((identifiant, &lt;ObjetPhysique&gt;), ...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">m</span><span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
                    <span class="n">ident</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                    <span class="n">o</span><span class="o">=</span><span class="n">ObjetPhysique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">ident</span><span class="p">]</span><span class="o">=</span><span class="n">o</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MainWindow.afficheListeObjets"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.afficheListeObjets">[docs]</a>    <span class="k">def</span> <span class="nf">afficheListeObjets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Affiche la liste des objetx en bas du premier ongle, et ajoute</span>
<span class="sd">        pour chacun une case à cocher si on le veut déplaçable à la souris</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">poBox</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">poBox</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">poBox</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ident</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">objetsPhysiques</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">b</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%6.2f</span><span class="s2">, </span><span class="si">%6.2f</span><span class="s2">)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">poBox</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">cb</span><span class="o">=</span><span class="n">b</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectObject</span><span class="p">(</span><span class="n">o</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindow.selectObject"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.selectObject">[docs]</a>    <span class="k">def</span> <span class="nf">selectObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fabrique de fonction de rappel pour les cases à cocher des </span>
<span class="sd">        objets physiques, qui conserve le contexte de l&#39;objet op</span>
<span class="sd">        afin de maintenir l&#39;ensemble self.objIdents</span>
<span class="sd">        </span>
<span class="sd">        :param op: un objet physique</span>
<span class="sd">        :type  op: ObjetPhysique</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">cb</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objIdents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objIdents</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">cb</span></div>

<div class="viewcode-block" id="MainWindow.startStop"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.startStop">[docs]</a>    <span class="k">def</span> <span class="nf">startStop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;arrête/relanche le timer&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stillFrame</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">playButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;media-playback-pause-symbolic&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">playButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;media-playback-start-symbolic&quot;</span><span class="p">))</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.back"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.back">[docs]</a>    <span class="k">def</span> <span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remet le compteur de frames à zéro</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animProgress</span><span class="p">()</span>
        <span class="c1"># dans tous les cas, réactive la boucle de temps</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.animProgress"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.animProgress">[docs]</a>    <span class="k">def</span> <span class="nf">animProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Montre dans la barre de progression et sous celle-ci où en est le</span>
<span class="sd">        temps de la vidéo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;video t = &quot;</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s2">&quot;</span><span class="si">%6.3f</span><span class="s2"> / </span><span class="si">%6.3f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_t</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_t</span>
                              <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">)</span>
        <span class="n">objetsPhysique</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectoires</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="n">objetsPhysique</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># met à jour les positions affichées des objets physiques</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCbText</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="c1"># définit self.stillFrame au cas où l&#39;animation est arretée</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stillFrame</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.simule"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.simule">[docs]</a>    <span class="k">def</span> <span class="nf">simule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Réalise la simulation de façon non-interactive, pour len(self.frames)</span>
<span class="sd">        images</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stillFrame</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">op</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objetsPhysiques</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span>
                <span class="n">h</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
            <span class="n">op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectoires</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.simulProgress"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.simulProgress">[docs]</a>    <span class="k">def</span> <span class="nf">simulProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        met à jour la barre de progression durant la simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;simultation, </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="MainWindow.enregistreFonctions"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.enregistreFonctions">[docs]</a>    <span class="k">def</span> <span class="nf">enregistreFonctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enregistre les fonctions écrites dans l&#39;onglet de programme,</span>
<span class="sd">        afin qu&#39;elles soient invoquées lors de la simulation. Les anciennes</span>
<span class="sd">        fonctions enregistrées sont effacées.</span>
<span class="sd">        </span>
<span class="sd">        :return: un dictionnaire : nom de fonction -&gt; tuple(exécutable, paramètres, aide)</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># efface les anciennes fonctions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectoires</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># idem pour les trajectoires des objets physiques</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulated</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># va provoquer une nouvelle simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentFrame</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># depuis le début</span>
        <span class="n">funcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">functionsFrom</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">funcs</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># dans tous les cas, redémarre une compilation sans attendre</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startStop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">funcs</span></div>

<div class="viewcode-block" id="MainWindow.functionsFrom"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.functionsFrom">[docs]</a>    <span class="k">def</span> <span class="nf">functionsFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compile la source de l&#39;onglet programmes en langage Python</span>

<span class="sd">        :return: un dictionnaire : nom de fonction -&gt; (code compilé, spécification d&#39;arguments, aide sur la fonction)</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progEdit</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span><span class="o">=</span><span class="nb">compile</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exec&quot;</span><span class="p">)</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">f</span><span class="p">]),</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">render_doc</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="s2">&quot;aide sur </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">f</span><span class="p">])}</span>
        <span class="k">except</span> <span class="ne">IndentationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">t</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">text</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Indentation error&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">line # </span><span class="si">{l}</span><span class="s2"> column # </span><span class="si">{c}</span><span class="s2"></span>
<span class="si">{t}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">t</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">text</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Syntax error&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">line # </span><span class="si">{l}</span><span class="s2"> column # </span><span class="si">{c}</span><span class="s2"></span>
<span class="si">{t}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="MainWindow.tryCompile"><a class="viewcode-back" href="../../jongle.html#jongle.main.MainWindow.tryCompile">[docs]</a>    <span class="k">def</span> <span class="nf">tryCompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        essaie de compiler et renvoi juste un message d&#39;accord si succès</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">functionsFrom</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Compilation successful&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Defined functions:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="k">return</span></div></div>

<div class="viewcode-block" id="videoToRgbFrameList"><a class="viewcode-back" href="../../jongle.html#jongle.main.videoToRgbFrameList">[docs]</a><span class="k">def</span> <span class="nf">videoToRgbFrameList</span><span class="p">(</span><span class="n">videofile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    transforme une vidéo lisible par openCV en une liste d&#39;images au</span>
<span class="sd">    format RGB.</span>

<span class="sd">    :param videofile: chemin d&#39;un fichier vidéo</span>
<span class="sd">    :type  videofile: str</span>
<span class="sd">    :return: liste d&#39;images RGB</span>
<span class="sd">    :rtype: numpy Array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frames</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">cap</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">videofile</span><span class="p">)</span>
    <span class="n">ok</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">while</span> <span class="n">ok</span><span class="p">:</span>
        <span class="n">ok</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">frames</span></div>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../jongle.html#jongle.main.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--prog&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;prog&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span><span class="s2">&quot;fonctions_base.py&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--video&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;video&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span><span class="s2">&quot;../videos/ffa-cropped-cut001.avi&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--scale&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="mi">290</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;--svg&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span><span class="s2">&quot;../ballon.svg&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--deltat&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;deltat&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="mf">40e-3</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="c1"># traduction</span>
    <span class="n">lang</span><span class="o">=</span><span class="n">QLocale</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">t</span><span class="o">=</span><span class="n">QTranslator</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;lang/&quot;</span><span class="o">+</span><span class="n">lang</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">t1</span><span class="o">=</span><span class="n">QTranslator</span><span class="p">()</span>
    <span class="n">t1</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;qt_&quot;</span><span class="o">+</span><span class="n">lang</span><span class="p">,</span>
            <span class="n">QLibraryInfo</span><span class="o">.</span><span class="n">location</span><span class="p">(</span><span class="n">QLibraryInfo</span><span class="o">.</span><span class="n">TranslationsPath</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>

    <span class="n">w</span><span class="o">=</span><span class="n">MainWindow</span><span class="p">(</span><span class="n">svg</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">svg</span><span class="p">,</span> <span class="n">delta_t</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">deltat</span><span class="p">,</span> <span class="n">ech</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
                 <span class="n">videofile</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">video</span><span class="p">,</span> <span class="n">progfile</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">prog</span>
    <span class="p">)</span>

    <span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">w</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">svgWidget</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">720</span><span class="p">,</span><span class="mi">576</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
    <span class="k">return</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentation IREM-Jongle 1.1</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Code du module</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Georges Khaznadar.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.
    </div>
  </body>
</html>